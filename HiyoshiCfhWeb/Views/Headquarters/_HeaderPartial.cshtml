@model HiyoshiCfhWeb.Models.Admiral
@{
    var admiral = Model;
    var db = HiyoshiCfhWeb.Models.ApplicationDbContext.Create();
    var admirals = db.Admirals;
    var subPages = HiyoshiCfhWeb.Controllers.HeadquartersController.subPages;
    string title = ViewBag.Title;
    IEnumerable<string> shipTypes = null;
    if (ViewBag.ShipType != null)
    {
        title = "所属艦娘";
        shipTypes = db.ShipTypes.ToList()
            .GroupBy(x => HiyoshiCfhWeb.Models.ShipType.GroupShipType(x.Name))
            .Select(x => x.Key);
    }
}

<div class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand">司令部</span>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       role="button" aria-haspopup="true" aria-expanded="false">@admiral.Name<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        @foreach (var item in admirals)
                        {
                            if (item.AdmiralId == admiral.AdmiralId)
                            {
                                <li class="disabled"><a href="#">@item.Name</a></li>
                            }
                            else if (ViewBag.ShipType != null)
                            {
                                <li>@Html.ActionLink(item.Name, null, new { id = item.Name, param = ViewBag.ShipType.Replace("+", "_") })</li>
                            }
                            else
                            {
                                <li>@Html.ActionLink(item.Name, null, new { id = item.Name })</li>
                            }
                        }
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       role="button" aria-haspopup="true" aria-expanded="false">@title<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        @foreach (var item in subPages)
                        {
                            if (item.Item1 == title)
                            {
                                <li class="disabled"><a href="#">@item.Item1</a></li>
                            }
                            else
                            {
                                <li>@Html.ActionLink(item.Item1, item.Item2, new { id = admiral.Name })</li>
                            }
                        }
                    </ul>
                </li>
                @if (ViewBag.ShipType != null)
                {
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                           role="button" aria-haspopup="true" aria-expanded="false">@ViewBag.ShipType<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            @foreach (var item in shipTypes)
                            {
                                if (item == ViewBag.ShipType)
                                {
                                    <li class="disabled"><a href="#">@item</a></li>
                                }
                                else
                                {
                                    <li>@Html.ActionLink(item, null, new { id = admiral.Name, param = item.Replace("+", "_") })</li>
                                }
                            }
                        </ul>
                    </li>
                }
            </ul>
        </div>
    </div>
</div>
<h2>@admiral.Name 提督 - @ViewBag.Title</h2>
